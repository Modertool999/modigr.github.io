<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Steam Game Recommender · Modi</title>
  <meta name="color-scheme" content="light dark" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>tailwind={config:{theme:{extend:{fontFamily:{sans:['Inter','ui-sans-serif','system-ui','Segoe UI','Helvetica Neue','Arial']},colors:{brand:{50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'}}}}}};</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --glass-bg: rgba(255,255,255,0.65); --glass-stroke: rgba(24,24,27,.08) }
    .dark:root { --glass-bg: rgba(24,24,27,0.55); --glass-stroke: rgba(250,250,250,.08) }
    .glass { background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid var(--glass-stroke); }
  </style>
</head>
<body class="bg-zinc-50 text-zinc-900 dark:bg-zinc-950 dark:text-zinc-100">
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-zinc-900/60 border-b border-zinc-200/70 dark:border-zinc-800/60">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="font-extrabold tracking-tight text-lg">Modi</a>
      <nav class="hidden sm:flex items-center gap-5 text-sm text-zinc-600 dark:text-zinc-400">
        <a href="index.html" class="hover:text-zinc-900 dark:hover:text-zinc-100">Home</a>
        <a href="steam.html" class="hover:text-zinc-900 dark:hover:text-zinc-100 font-semibold">Steam</a>
        <a href="spy.html" class="hover:text-zinc-900 dark:hover:text-zinc-100">SPY</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-10">
    <section class="glass rounded-3xl p-6">
      <h1 class="text-3xl font-bold">Steam Game Recommender</h1>
      <p class="text-sm text-zinc-600 dark:text-zinc-400 mt-1 max-w-2xl">Content‑based filtering over the top 20k Steam games (TF‑IDF on name/description/genres) blended with social playtime from you + friends via the Steam Web API. Adjust weights to taste.</p>
      <div class="text-xs mt-2"><a class="underline" href="https://github.com/Modertool999/game-recommender" target="_blank">View the code</a></div>
    </section>

    <section class="mt-6 glass rounded-3xl p-6">
      <form id="steamForm" class="space-y-4" novalidate>
        <div class="grid sm:grid-cols-3 gap-4">
          <label class="text-sm">SteamID64
            <input id="steamId" inputmode="numeric" pattern="^7656119\d{10}$" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-transparent px-3 py-2" placeholder="7656119XXXXXXXXXX" required aria-describedby="steamHelp steamErr" />
            <div id="steamHelp" class="text-xs text-zinc-500 mt-1">Find it at <a class="underline" href="https://steamid.io/lookup" target="_blank">steamid.io/lookup</a> → copy <em>SteamID64</em>.</div>
            <div id="steamErr" class="hidden text-xs text-red-600 mt-1"></div>
          </label>
          <label class="text-sm">Content weight (TF‑IDF)
            <input id="wContent" type="range" min="0" max="1" step="0.05" value="0.6" class="mt-3 w-full" />
            <div class="text-xs text-zinc-500">Value: <span id="wContentVal">0.60</span></div>
          </label>
          <label class="text-sm">Playtime weight
            <input id="wPlay" type="range" min="0" max="1" step="0.05" value="0.4" class="mt-3 w-full" />
            <div class="text-xs text-zinc-500">Value: <span id="wPlayVal">0.40</span></div>
          </label>
        </div>
        <div class="flex items-center gap-3">
          <button id="recBtn" type="submit" class="rounded-xl px-4 py-2 bg-brand-600 text-white hover:bg-brand-700 disabled:opacity-50">Get recommendations</button>
          <button id="recReset" type="button" class="rounded-xl px-4 py-2 border border-zinc-300 dark:border-zinc-700">Reset</button>
          <span id="recStatus" class="text-xs text-zinc-500" aria-live="polite"></span>
        </div>
        <div id="recListWrap" class="mt-3 grid sm:grid-cols-2 gap-3" aria-live="polite"></div>
      </form>
    </section>

    <section class="mt-6 glass rounded-3xl p-6">
      <h2 class="text-lg font-semibold">How it works</h2>
      <ul class="list-disc pl-5 text-sm mt-2 space-y-1 text-zinc-700 dark:text-zinc-300">
        <li>Builds a catalog of top 20k games (SQLite) with name/description/genres → TF‑IDF vectors.</li>
        <li>Fetches your + friends’ recent playtime via Steam Web API.</li>
        <li>Scores candidates with weighted signals: content similarity, friends’ playtime, similarity to friends’ recent plays.</li>
      </ul>
    </section>
  </main>

  <footer class="py-10 text-center text-xs text-zinc-500">© <span id="y"></span> Modi Goldstein‑Rosenfeld · Steam Recommender</footer>

  <script>
    const CONFIG = { endpoints: { steamRec: 'https://steam-rec-modi-2-gdefgecbdah9hqfx.westus-01.azurewebsites.net/api/recommend' }, requestTimeoutMs: 20000 };
    const qs = (sel)=>document.querySelector(sel);
    document.getElementById('y').textContent = new Date().getFullYear();
    const savedTheme = localStorage.getItem('theme'); if (savedTheme) document.documentElement.classList.toggle('dark', savedTheme==='dark');
    const setStatus=(el,msg,ok=false)=>{ el.textContent=msg; el.className=`text-xs ${ok? 'text-green-600 dark:text-green-400':'text-zinc-500'}` };
    const isSteam64=(s)=>/^7656119\d{10}$/.test(s);
    const fetchWithTimeout=(url,opt={},ms=15000)=>{ const c=new AbortController(); const t=setTimeout(()=>c.abort(),ms); return fetch(url,{...opt,signal:c.signal}).finally(()=>clearTimeout(t)); };

    qs('#wContent').addEventListener('input', e=> qs('#wContentVal').textContent = Number(e.target.value).toFixed(2));
    qs('#wPlay').addEventListener('input',   e=> qs('#wPlayVal').textContent   = Number(e.target.value).toFixed(2));

    const form = qs('#steamForm');
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = qs('#recBtn');
      const steamId=(qs('#steamId').value||'').trim();
      const wContent=parseFloat(qs('#wContent').value||'0.6');
      const wPlay=parseFloat(qs('#wPlay').value||'0.4');
      const status=qs('#recStatus');
      const wrap=qs('#recListWrap');
      const err=qs('#steamErr');
      wrap.innerHTML=''; err.classList.add('hidden'); err.textContent='';

      if (!CONFIG.endpoints.steamRec){ setStatus(status,'Not configured.'); return; }
      if (!isSteam64(steamId)){ err.textContent='Invalid SteamID64 (17 digits starting with 7656119).'; err.classList.remove('hidden'); return; }
      try { localStorage.setItem('steamId', steamId); } catch {}

      try{
        btn.disabled=true; setStatus(status,'Calling backend…');
        const u=new URL(CONFIG.endpoints.steamRec);
        u.searchParams.set('steam_id', steamId);
        u.searchParams.set('k', 10);
        u.searchParams.set('w_content', wContent);
        u.searchParams.set('w_playtime', wPlay);
        const res=await fetchWithTimeout(u.toString(),{method:'GET'},CONFIG.requestTimeoutMs);
        if(!res.ok){ const txt=await res.text(); throw new Error(`HTTP ${res.status}: ${txt.slice(0,160)}`); }
        const data=await res.json();
        if(!Array.isArray(data)||data.length===0){ setStatus(status,'No recommendations (privacy / not enough recent playtime).'); return; }
        data.slice(0,12).forEach(r=>{
          const card=document.createElement('div'); card.className='rounded-xl border border-zinc-200 dark:border-zinc-800 p-3 flex items-center justify-between';
          const title=document.createElement('div'); title.className='text-sm'; title.textContent=r.title||'Unknown';
          const badge=document.createElement('span'); badge.className='text-xs px-2 py-0.5 rounded-full bg-brand-100 text-brand-700'; badge.textContent= typeof r.score==='number'? `${(r.score*100).toFixed(0)}%`:'rec';
          card.appendChild(title); card.appendChild(badge); wrap.appendChild(card);
        });
        setStatus(status,'Done.',true);
      }catch(e){ console.error(e); setStatus(status, `Error: ${e.message||e}`); }
      finally{ btn.disabled=false; }
    });

    try { const last=localStorage.getItem('steamId'); if(last) qs('#steamId').value=last; } catch {}
    qs('#recReset').addEventListener('click',()=>{ qs('#steamId').value=''; qs('#recListWrap').innerHTML=''; qs('#recStatus').textContent=''; qs('#steamErr').classList.add('hidden'); });
  </script>
</body>
</html>
