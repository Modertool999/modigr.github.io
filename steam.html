<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Steam Game Recommender · Modi</title>
  <meta name="color-scheme" content="light dark" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>tailwind={config:{theme:{extend:{fontFamily:{sans:['Inter','ui-sans-serif','system-ui','Segoe UI','Helvetica Neue','Arial']},colors:{brand:{50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'}}}}}};</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --glass-bg: rgba(255,255,255,0.85); --glass-stroke: rgba(24,24,27,.10) }
    .dark:root { --glass-bg: rgba(24,24,27,0.65); --glass-stroke: rgba(250,250,250,.10) }
    .glass { background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid var(--glass-stroke); }
  </style>
</head>
<body class="bg-white text-zinc-900 dark:bg-zinc-950 dark:text-zinc-100">
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-zinc-900/60 border-b border-zinc-200/70 dark:border-zinc-800/60">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="font-extrabold tracking-tight text-lg">Modi</a>
      <nav class="hidden sm:flex items-center gap-5 text-sm text-zinc-600 dark:text-zinc-400">
        <a href="index.html" class="hover:text-zinc-900 dark:hover:text-zinc-100">Home</a>
        <a href="steam.html" class="hover:text-zinc-900 dark:hover:text-zinc-100 font-semibold">Steam</a>
        <a href="spy.html" class="hover:text-zinc-900 dark:hover:text-zinc-100">SPY</a>
        <button id="themeToggle" class="ml-2 rounded-full px-3 py-1.5 border border-zinc-300 dark:border-zinc-700 text-xs">☀︎ / ☾</button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-10">
    <section class="glass rounded-3xl p-6">
      <h1 class="text-3xl font-bold">Steam Game Recommender</h1>
      <p class="text-sm text-zinc-700 dark:text-zinc-300 mt-1 max-w-2xl">
        TF-IDF on game text blended with social signals (friends’ playtime & similarity). Paste your
        <strong>SteamID64</strong> and tune the three weights.
      </p>
      <div class="text-xs mt-2"><a class="underline" href="https://github.com/Modertool999/game-recommender" target="_blank">View the code</a></div>
    </section>

    <section class="mt-6 glass rounded-3xl p-6">
      <form id="steamForm" class="space-y-4" novalidate>
        <div class="grid sm:grid-cols-3 gap-4">
          <label class="text-sm">SteamID64
            <input id="steamId" inputmode="numeric" pattern="^7656119\d{10}$" class="mt-1 w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-transparent px-3 py-2" placeholder="7656119XXXXXXXXXX" required />
            <div id="steamErr" class="hidden text-xs text-red-600 mt-1"></div>
            <div class="text-xs text-zinc-500 mt-1">Find it at <a class="underline" href="https://steamid.io/lookup" target="_blank">steamid.io/lookup</a> → copy <em>SteamID64</em>.</div>
          </label>
          <label class="text-sm">Content weight (TF-IDF)
            <input id="wContent" type="range" min="0" max="1" step="0.05" value="0.60" class="mt-3 w-full" />
            <div class="text-xs text-zinc-500">Value: <span id="wContentVal">0.60</span></div>
          </label>
          <label class="text-sm">Friends' playtime weight
            <input id="wPlay" type="range" min="0" max="1" step="0.05" value="0.30" class="mt-3 w-full" />
            <div class="text-xs text-zinc-500">Value: <span id="wPlayVal">0.30</span></div>
          </label>
          <label class="text-sm sm:col-span-3">Friends' similarity weight
            <input id="wSocial" type="range" min="0" max="1" step="0.05" value="0.10" class="mt-3 w-full" />
            <div class="text-xs text-zinc-500">Value: <span id="wSocialVal">0.10</span> · Tip: if scores look flat, nudge weights.</div>
          </label>
        </div>
        <div class="flex items-center gap-3">
          <button id="recBtn" type="submit" class="rounded-lg px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white disabled:opacity-50">Get recommendations</button>
          <button id="recReset" type="button" class="rounded-lg px-3 py-1.5 border border-zinc-300 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800">Reset</button>
          <span id="recStatus" class="text-xs text-zinc-500" aria-live="polite"></span>
        </div>
        <ul id="recList" class="mt-2 text-sm list-disc pl-5 space-y-1"></ul>
        <p id="recHint" class="hidden mt-2 text-xs text-amber-700 dark:text-amber-400">
          All scores are 0%. If your Steam profile or recent games are private—or you haven’t played recently—the model can’t personalize.
          Try increasing <em>Content</em> weight or making playtime visible, then retry.
        </p>
      </form>
    </section>

    <section class="mt-6 glass rounded-3xl p-6">
      <h2 class="text-lg font-semibold">How it works</h2>
      <ul class="list-disc pl-5 text-sm mt-2 space-y-1 text-zinc-700 dark:text-zinc-300">
        <li>Catalog of top 20k games with name/description/genres → TF-IDF vectors.</li>
        <li>Aggregates your + friends’ recent playtime via Steam Web API.</li>
        <li>Scores candidates with weighted signals: content similarity, friends’ playtime, friends’ similarity.</li>
      </ul>
    </section>
  </main>

  <footer class="py-10 text-center text-xs text-zinc-500">© <span id="y"></span> Modi Goldstein-Rosenfeld · Steam Recommender</footer>

  <script>
    // === CONFIG: set your live endpoint ===
    const CONFIG = {
      endpoints: {
        steamRec: 'https://steam-rec-modi-2-gdefgecbdah9hqfx.westus-01.azurewebsites.net/api/recommend'
      },
      requestTimeoutMs: 20000
    };

    const $ = (s)=>document.querySelector(s);
    document.getElementById('y').textContent = new Date().getFullYear();

    // theme persistence shared with home
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) document.documentElement.classList.toggle('dark', savedTheme==='dark');
    document.getElementById('themeToggle').addEventListener('click', ()=>{
      const toDark = !document.documentElement.classList.contains('dark');
      document.documentElement.classList.toggle('dark', toDark);
      localStorage.setItem('theme', toDark? 'dark':'light');
    });

    // helpers
    const setStatus=(el,msg,ok=false)=>{ el.textContent=msg; el.className=`text-xs ${ok? 'text-green-600 dark:text-green-400':'text-zinc-500'}` };
    const isSteam64=(s)=>/^7656119\d{10}$/.test(s);
    const fetchWithTimeout=(url,opt={},ms=15000)=>{ const c=new AbortController(); const t=setTimeout(()=>c.abort(),ms); return fetch(url,{...opt,signal:c.signal}).finally(()=>clearTimeout(t)); };

    // live labels
    $('#wContent').addEventListener('input', e=> $('#wContentVal').textContent = Number(e.target.value).toFixed(2));
    $('#wPlay').addEventListener('input',   e=> $('#wPlayVal').textContent   = Number(e.target.value).toFixed(2));
    $('#wSocial').addEventListener('input', e=> $('#wSocialVal').textContent = Number(e.target.value).toFixed(2));

    // restore last steam id
    try { const last = localStorage.getItem('steamId'); if (last) $('#steamId').value = last; } catch {}

    // submit
    document.getElementById('steamForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = $('#recBtn');
      const steamId=($('#steamId').value||'').trim();
      const wContent=parseFloat($('#wContent').value||'0.6');
      const wPlay=parseFloat($('#wPlay').value||'0.3');
      const wSocial=parseFloat($('#wSocial').value||'0.1');
      const status=$('#recStatus');
      const list=$('#recList');
      const err=$('#steamErr');
      const hint=$('#recHint');
      list.innerHTML=''; err.classList.add('hidden'); err.textContent=''; hint.classList.add('hidden');

      if (!CONFIG.endpoints.steamRec){ setStatus(status,'Not configured.'); return; }
      if (!isSteam64(steamId)){ err.textContent='Invalid SteamID64 (17 digits starting with 7656119).'; err.classList.remove('hidden'); return; }
      try { localStorage.setItem('steamId', steamId); } catch {}

      try{
        btn.disabled = true; setStatus(status,'Calling backend…');
        const u=new URL(CONFIG.endpoints.steamRec);
        u.searchParams.set('steam_id', steamId);
        u.searchParams.set('k', 10);
        u.searchParams.set('w_content', wContent);
        u.searchParams.set('w_playtime', wPlay);
        u.searchParams.set('w_social', wSocial); // third weight

        const res = await fetchWithTimeout(u.toString(), { method:'GET' }, CONFIG.requestTimeoutMs);
        if (!res.ok){ const txt = await res.text(); throw new Error(`HTTP ${res.status}: ${txt.slice(0,160)}`); }
        const data = await res.json();

        if (!Array.isArray(data) || data.length===0){ setStatus(status,'No recommendations (privacy / not enough recent playtime).'); return; }

        let zeroCount = 0;
        data.slice(0,12).forEach(r=>{
          const li=document.createElement('li');
          const val = (typeof r.score === 'number') ? r.score : 0;
          if (val === 0) zeroCount++;
          const score = (typeof r.score === 'number') ? ` — score ${(r.score*100).toFixed(0)}%` : '';
          li.textContent = `${r.title}${score}`;
          list.appendChild(li);
        });
        if (zeroCount === Math.min(12, data.length)) { hint.classList.remove('hidden'); }
        setStatus(status,'Done.',true);
      }catch(e){ console.error(e); setStatus(status, `Error: ${e.message||e}`); }
      finally{ btn.disabled=false; }
    });

    document.getElementById('recReset').addEventListener('click', ()=>{
      $('#steamId').value=''; $('#recList').innerHTML=''; $('#recStatus').textContent=''; $('#steamErr').classList.add('hidden'); $('#recHint').classList.add('hidden');
    });
  </script>
</body>
</html>
